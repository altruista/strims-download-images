#!/bin/sh
read -d '' PHP_SCRIPT <<- EOF
PD9waHAKCiAvKioKICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMu
cGwvdS9hbHRydWlzdGE+CiAqLyAgICAKZnVuY3Rpb24gZmluZF9iZXR3ZWVuKCRz
dHIsICRmcm9tLCAkdG8gPSBmYWxzZSkKewogICAgJHRtcCA9IGV4cGxvZGUoJGZy
b20sICRzdHIpOwogICAgdW5zZXQoJHRtcFswXSk7CiAgICAkcmVzdWx0ID0gQXJy
YXkoKTsKICAgIGZvcmVhY2ggKCR0bXAgYXMgJGNodW5rKSB7CiAgICAgICAgaWYg
KCR0byA9PT0gZmFsc2UgJiYgJGNodW5rKSB7CiAgICAgICAgICAgICRyZXN1bHRb
XSA9ICRjaHVuazsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAg
ICAgIGxpc3QoJGFkZCkgPSBleHBsb2RlKCR0bywgJGNodW5rKTsKICAgICAgICBp
ZiAoJGFkZCkgewogICAgICAgICAgICAkcmVzdWx0W10gPSAkYWRkOwogICAgICAg
IH0KICAgIH0KICAgIHJldHVybiAkcmVzdWx0Owp9CgogLyoqCiAqIEBhdXRob3Ig
QWx0cnVpc3RhIDxodHRwOi8vc3RyaW1zLnBsL3UvYWx0cnVpc3RhPgogKi8gIApm
dW5jdGlvbiBmaW5kX29uZV9iZXR3ZWVuKCRzdHIsICRmcm9tLCAkdG8gPSBmYWxz
ZSkKewogICAgJHJlc3VsdCA9IGZpbmRfYmV0d2Vlbigkc3RyLCAkZnJvbSwgJHRv
KTsKICAgIHJldHVybiBpc3NldCgkcmVzdWx0WzBdKSA/ICRyZXN1bHRbMF0gOiBm
YWxzZTsKfQoKIC8qKgogKiBjVVJMCiAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRw
Oi8vc3RyaW1zLnBsL3UvYWx0cnVpc3RhPgogKi8gIApjbGFzcyBBUElfQ3VybAp7
ICAgIAogICAgcHVibGljICAgICAgJGh0bWw7CiAgICBwdWJsaWMgICAgICAkbGFz
dF91cmwgPSAiIjsKICAgIHByaXZhdGUgICAgICRfY2ggICAgICA9IGZhbHNlOwog
ICAgcHJvdGVjdGVkICAgJF9jb25maWcgID0gQXJyYXkoCiAgICAgICAgJ2Nvb2tp
ZV9maWxlJyA9PiAnY29va2llLnR4dCcsCiAgICAgICAgJ3VzZXJfYWdlbnQnID0+
ICdNb3ppbGxhLzQuMCAoY29tcGF0aWJsZTsgTVNJRSA2LjA7IFdpbmRvd3MgTlQg
NS4xJwogICAgKTsKICAgIAogICAgCiAgICAvKioKICAgICAqIEtvbnN0cnVrdG9y
IGFwaQogICAgICogQHBhcmFtIGFycmF5ICRjb25maWcgdXN0YXdpZW5pYS4gbW/F
vG5hIG9rcmXFm2xpxIcgcG/Fgm/FvGVuaWUgcGxpa3UgY29va2llCiAgICAgKiBA
dGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19j
b25zdHJ1Y3QoJGNvbmZpZyA9IEFycmF5KCkpCiAgICB7CiAgICAgICAgJHRoaXMt
Pl9jb25maWcgPSBhcnJheV9tZXJnZSgkdGhpcy0+X2NvbmZpZywgJGNvbmZpZyk7
CiAgICAgICAgaWYgKCFpc193cml0ZWFibGUoJHRoaXMtPl9jb25maWdbJ2Nvb2tp
ZV9maWxlJ10pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIlBs
aWsgeyR0aGlzLT5fY29uZmlnWydjb29raWVfZmlsZSddfSBuaWUgbWEgdXByYXdu
aWVuIGRvIHphcGlzdSEiKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZh
dGUgZnVuY3Rpb24gX2N1cmxfaW5pdCgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlz
LT5fY2gpIHsKICAgICAgICAgICAgY3VybF9jbG9zZSgkdGhpcy0+X2NoKTsKICAg
ICAgICB9CiAgICAgICAgJHRoaXMtPl9jaCA9IGN1cmxfaW5pdCgpOwogICAgICAg
IGN1cmxfc2V0b3B0KCR0aGlzLT5fY2gsIENVUkxPUFRfQ09PS0lFRklMRSwgJHRo
aXMtPl9jb25maWdbJ2Nvb2tpZV9maWxlJ10pOwogICAgICAgIGN1cmxfc2V0b3B0
KCR0aGlzLT5fY2gsIENVUkxPUFRfQ09PS0lFSkFSLCAkdGhpcy0+X2NvbmZpZ1sn
Y29va2llX2ZpbGUnXSk7CiAgICAgICAgY3VybF9zZXRvcHQoJHRoaXMtPl9jaCwg
Q1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgMSk7CiAgICAgICAgLy9jdXJsX3NldG9w
dCgkdGhpcy0+X2NoLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxKTsgbmllIGR6
aWHFgmEgdyBzYWZlX21vZGUuLi4KICAgICAgICBjdXJsX3NldG9wdCgkdGhpcy0+
X2NoLCBDVVJMT1BUX1VTRVJBR0VOVCwgJHRoaXMtPl9jb25maWdbJ3VzZXJfYWdl
bnQnXSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgZnVuY3Rpb24gX2N1cmxfY2xv
c2UoKQogICAgewogICAgICAgIGN1cmxfY2xvc2UoJHRoaXMtPl9jaCk7CiAgICAg
ICAgJHRoaXMtPl9jaCA9IGZhbHNlOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVu
Y3Rpb24gZ2V0KCR1cmwpCiAgICB7CiAgICAgICAgJHRoaXMtPl9jdXJsX2luaXQo
KTsKICAgICAgICAkdGhpcy0+bGFzdF91cmwgPSAkdXJsOwogICAgICAgIGN1cmxf
c2V0b3B0KCR0aGlzLT5fY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsKICAgICAgICAk
dGhpcy0+aHRtbCA9ICR0aGlzLT5fY3VybF9leGVjKCR0aGlzLT5fY2gpOwogICAg
ICAgICR0aGlzLT5fY3VybF9jbG9zZSgpOwogICAgICAgIHJldHVybiAkdGhpcy0+
aHRtbDsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHBvc3QoJHVybCwg
JGRhdGEsICRub19yZWRpcmVjdCA9IGZhbHNlKQogICAgewogICAgICAgICR0aGlz
LT5fY3VybF9pbml0KCk7CiAgICAgICAgJHRoaXMtPmxhc3RfdXJsID0gJHVybDsK
ICAgICAgICBjdXJsX3NldG9wdCgkdGhpcy0+X2NoLCBDVVJMT1BUX1VSTCwgJHVy
bCk7CiAgICAgICAgY3VybF9zZXRvcHQoJHRoaXMtPl9jaCwgQ1VSTE9QVF9QT1NU
LCAxKTsKICAgICAgICBjdXJsX3NldG9wdCgkdGhpcy0+X2NoLCBDVVJMT1BUX1BP
U1RGSUVMRFMsIGh0dHBfYnVpbGRfcXVlcnkoJGRhdGEpKTsKICAgICAgICBpZiAo
JG5vX3JlZGlyZWN0KSB7CiAgICAgICAgICAgICR0aGlzLT5odG1sID0gY3VybF9l
eGVjKCR0aGlzLT5fY2gpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0
aGlzLT5odG1sID0gJHRoaXMtPl9jdXJsX2V4ZWMoJHRoaXMtPl9jaCk7CiAgICAg
ICAgfQogICAgICAgICR0aGlzLT5fY3VybF9jbG9zZSgpOwogICAgICAgIHJldHVy
biAkdGhpcy0+aHRtbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDaGFtc2th
IGZ1bmtjamEgYm8gQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiBuaWUgZHppYcWCYSB3
IHNhZmVfbW9kZSA6LyAgICAgICAgICAgKgogICAgICovCiAgICBwcml2YXRlIGZ1
bmN0aW9uIF9jdXJsX2V4ZWMoJGNoLCAmJG1heHJlZGlyZWN0ID0gbnVsbCkKICAg
IHsKICAgICAgICAkbXIgPSAkbWF4cmVkaXJlY3QgPT09IG51bGwgPyAxMCA6IGlu
dHZhbCgkbWF4cmVkaXJlY3QpOwogICAgICAgIGlmIChpbmlfZ2V0KCdvcGVuX2Jh
c2VkaXInKSA9PSAnJyAmJiBpbmlfZ2V0KCdzYWZlX21vZGUnID09ICdPZmYnKSkg
ewogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRk9MTE9XTE9D
QVRJT04sICRtciA+IDApOwogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENV
UkxPUFRfTUFYUkVESVJTLCAkbXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg
ICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgZmFs
c2UpOwogICAgICAgICAgICBpZiAoJG1yID4gMCkgewogICAgICAgICAgICAgICAg
JG5ld3VybCA9IGN1cmxfZ2V0aW5mbygkY2gsIENVUkxJTkZPX0VGRkVDVElWRV9V
UkwpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkcmNoID0gY3Vy
bF9jb3B5X2hhbmRsZSgkY2gpOwogICAgICAgICAgICAgICAgY3VybF9zZXRvcHQo
JHJjaCwgQ1VSTE9QVF9IRUFERVIsIHRydWUpOwogICAgICAgICAgICAgICAgY3Vy
bF9zZXRvcHQoJHJjaCwgQ1VSTE9QVF9OT0JPRFksIGZhbHNlKTsKICAgICAgICAg
ICAgICAgIGN1cmxfc2V0b3B0KCRyY2gsIENVUkxPUFRfRk9SQklEX1JFVVNFLCBm
YWxzZSk7CiAgICAgICAgICAgICAgICBjdXJsX3NldG9wdCgkcmNoLCBDVVJMT1BU
X1JFVFVSTlRSQU5TRkVSLCB0cnVlKTsKICAgICAgICAgICAgICAgIGN1cmxfc2V0
b3B0KCRyY2gsIENVUkxPUFRfQ09PS0lFRklMRSwgJHRoaXMtPl9jb25maWdbJ2Nv
b2tpZV9maWxlJ10pOwogICAgICAgICAgICAgICAgY3VybF9zZXRvcHQoJHJjaCwg
Q1VSTE9QVF9DT09LSUVKQVIsICR0aGlzLT5fY29uZmlnWydjb29raWVfZmlsZSdd
KTsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBjdXJs
X3NldG9wdCgkcmNoLCBDVVJMT1BUX1VSTCwgJG5ld3VybCk7CiAgICAgICAgICAg
ICAgICAgICAgJGhlYWRlciA9IGN1cmxfZXhlYygkcmNoKTsKICAgICAgICAgICAg
ICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoY3VybF9lcnJubygkcmNo
KSkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29kZSA9IDA7CiAgICAgICAg
ICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNv
ZGUgPSBjdXJsX2dldGluZm8oJHJjaCwgQ1VSTElORk9fSFRUUF9DT0RFKTsKICAg
ICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2RlID09IDMwMSB8fCAkY29kZSA9
PSAzMDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWdfbWF0Y2go
Jy9Mb2NhdGlvbjooLio/KVxuLycsICRoZWFkZXIsICRtYXRjaGVzKTsKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICRuZXd1cmwgPSB0cmltKGFycmF5X3BvcCgk
bWF0Y2hlcykpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJGNvZGUgPSAwOwogICAgICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICAgICR0aGlzLT5sYXN0X3VybCA9ICRuZXd1cmw7CiAgICAgICAgICAgICAg
ICB9IHdoaWxlICgkY29kZSAmJiAtLSRtcik7CiAgICAgICAgICAgICAgICBjdXJs
X2Nsb3NlKCRyY2gpOwogICAgICAgICAgICAgICAgaWYgKCEkbXIpIHsKICAgICAg
ICAgICAgICAgICAgICBpZiAoJG1heHJlZGlyZWN0ID09PSBudWxsKSB7CiAgICAg
ICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ1RvbyBtYW55
IHJlZGlyZWN0cy4gV2hlbiBmb2xsb3dpbmcgcmVkaXJlY3RzLCBsaWJjdXJsIGhp
dCB0aGUgbWF4aW11bSBhbW91bnQuJyk7CiAgICAgICAgICAgICAgICAgICAgfSBl
bHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1heHJlZGlyZWN0ID0gMDsK
ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu
IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3VybF9z
ZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgJG5ld3VybCk7CiAgICAgICAgICAgICAg
ICAkdGhpcy0+bGFzdF91cmwgPSAkbmV3dXJsOwogICAgICAgICAgICB9CiAgICAg
ICAgfQogICAgICAgIHJldHVybiBjdXJsX2V4ZWMoJGNoKTsKICAgIH0KfQoKY2xh
c3MgU3RyaW1zIGV4dGVuZHMgQVBJX0N1cmwKewogICAgLyoqCiAgICAgKiBAdmFy
IHN0cmluZyBkb21lbmEgc3RyaW1zCiAgICAgKiBAYXV0aG9yIEFsdHJ1aXN0YSA8
aHR0cDovL3N0cmltcy5wbC91L2FsdHJ1aXN0YT4KICAgICAqLwogICAgcHJpdmF0
ZSAkX3N0cmltc19kb21haW4gPSAnaHR0cDovL3N0cmltcy5wbC8nOwogICAgCiAg
ICAvKioKICAgICAqIEB2YXIgc3RyaW5nIHRva2VuIHNlc2ppLiBwYXRyeiBnZXRf
dG9rZW4oKQogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMu
cGwvdS9hbHRydWlzdGE+CiAgICAgKi8gICAgCiAgICBwcml2YXRlICRfdG9rZW47
CiAgICAKICAgIC8qKgogICAgICogQHZhciBib29sIHByYXdkYSBqZcWbbGkgamVz
dGXFm215IHphbG9nb3dhbmkKICAgICAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRw
Oi8vc3RyaW1zLnBsL3UvYWx0cnVpc3RhPgogICAgICovCiAgICBwcml2YXRlICRf
bG9nZ2VkX2luOwogICAgCiAgICAvKioKICAgICAqIEJhem93YSBtZXRvZGEgd3lz
ecWCYWrEhWNhIHphcHl0YW5pZSBHRVQgZG8gc2Vyd2VyYQogICAgICogQGF1dGhv
ciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMucGwvdS9hbHRydWlzdGE+CiAgICAg
KiBAcGFyYW0gc3RyaW5nICR1cmwgbG9rYWNqYSBucC4gdS9hbHRydWlzdGEKICAg
ICAqIEByZXR1cm4gc3RyaW5nIGh0bWwKICAgICAqLwogICAgcHVibGljIGZ1bmN0
aW9uIGdldCgkdXJsKQogICAgewogICAgICAgIHJldHVybiBwYXJlbnQ6OmdldCgk
dGhpcy0+X3N0cmltc19kb21haW4gLiAkdXJsKTsKICAgIH0KICAgIAogICAgLyoq
CiAgICAgKiBCYXpvd2EgbWV0b2RhIHd5c3nFgmFqxIVjYSB6YXB5dGFuaWUgUE9T
VCBkbyBzZXJ3ZXJhCiAgICAgKiBAYXV0aG9yIEFsdHJ1aXN0YSA8aHR0cDovL3N0
cmltcy5wbC91L2FsdHJ1aXN0YT4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHVybCBs
b2thY2phIG5wLiB1L2FsdHJ1aXN0YQogICAgICogQHJldHVybiBzdHJpbmcgaHRt
bAogICAgICovICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHBvc3QoJHVybCwgJGRh
dGEsICRub19yZWRpcmVjdCA9IGZhbHNlKQogICAgewogICAgICAgIHJldHVybiBw
YXJlbnQ6OnBvc3QoJHRoaXMtPl9zdHJpbXNfZG9tYWluIC4gJHVybCwgJGRhdGEs
ICRub19yZWRpcmVjdCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogWmFtaWVu
aWEga3LDs3RrxIUgbG9rYWNqxJkgKHVybCkgbmEgcGXFgm55IHVybCAoc2VvLWZy
aWVuZGx5KQogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMu
cGwvdS9hbHRydWlzdGE+CiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaG9ydF9sb2Nh
dGlvbiBrcsOzdGthIGxva2FjamEgbmEgc3RyaW1zaWUgbnAuIHQvYWJjMTIzLCAK
ICAgICAqIEByZXR1cm4gc3RyaW5nIHBlxYJuYSBsb2thY2phIG5hIHN0cmltc2ll
IG5wLiBzL25hendhX3N0cmltdS90L2FiYzEyMy90eXR1bC10cmVzY2kKICAgICAq
LwogICAgcHVibGljIGZ1bmN0aW9uIGdldF9mdWxsX2xvY2F0aW9uKCRzaG9ydF9s
b2NhdGlvbikKICAgIHsKICAgICAgICAkdGhpcy0+Z2V0KCRzaG9ydF9sb2NhdGlv
bik7CiAgICAgICAgLy8gd3ljaW5hbXkgcG9jesSFdGtvd2UgImh0dHA6Ly9zdHJp
bXMucGwvIgogICAgICAgIGxpc3QoJG5pbCwgJHJlc3VsdCkgPSBleHBsb2RlKCc6
Ly9zdHJpbXMucGwvJywgJHRoaXMtPmxhc3RfdXJsLCAyKTsKICAgICAgICByZXR1
cm4gJHJlc3VsdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBQb2JpZXJhIHR5
dHVsIHRyZXNjaSB6IGxpbmt1ICBrcm90a2llZ28KICAgICAqIEBhdXRob3IgU2lt
aXZhciA8aHR0cDovL3N0cmltcy5wbC91L3NpbWl2YXI+CiAgICAgKiBAcGFyYW0g
c3RyaW5nICRzaG9ydF9saW5rIGtyb3RrYSBsb2thY2phIHcgc3RyaW1zaWUsIG5w
LiBzL01hcml1c3pNYXhLb2xvbmtvL3QvYnNseWt0LwogICAgICogQHJldHVybiBz
dHJpbmcgendyYWNhIHR5dHVsIG5wLiBtYXgta29sb25rby1wb2xpdHljem5lLWdy
emVjaHktb2JhbXkKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0X3RpdGxl
KCAkc2hvcnRfbGluayApewogICAgICAgICRmdWxsX2xpbmsgPSAkdGhpcy0+Z2V0
X2Z1bGxfbG9jYXRpb24oJHNob3J0X2xpbmspOwogICAgCXJldHVybiBzdHJfcmVw
bGFjZSgkc2hvcnRfbGluaywgJycsICRmdWxsX2xpbmspOwogICAgfQogICAgCiAg
ICAvKioKICAgICAqIFBvYmllcmEgdG9rZW4gc2VzamkuIFRva2VuIGplc3QgdcW8
eXdhbnkgZG8gdGVnbywKICAgICAqIGFieSBuaWt0IG5pZSBtw7NnxYIgc3ByZXBy
YXJvd2HEhyBsaW5rYSBkbyBVVi9EViBpdGQuCiAgICAgKiBXeWtvcCBzd2VnbyBj
emFzdSBtaWHFgiB0ZW4gcHJvYmxlbSAtICJzYW1vd3lrb3B1amFjZSBzaWUgem5l
bHppc2tvIgogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMu
cGwvdS9hbHRydWlzdGE+CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAg
ICBwdWJsaWMgZnVuY3Rpb24gZ2V0X3Rva2VuKCkKICAgIHsKICAgICAgICAkdGhp
cy0+Z2V0KCd6YWxvZ3VqJyk7CiAgICAgICAgcmV0dXJuIGZpbmRfb25lX2JldHdl
ZW4oJHRoaXMtPmh0bWwsICJwYWdlX3RlbXBsYXRlLnRva2VuID0gJyIsICInIik7
CiAgICB9CiAgICAKICAgIC8qKgogICAgICogTG9nb3dhbmllIGRvIHN0cmltcy5w
bAogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMucGwvdS9h
bHRydWlzdGE+CiAgICAgKiBAcGFyYW0gc3RyaW5nICR1c2VybmFtZSBOYXp3YSB1
xbx5dGtvd25pa2EKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhc3N3b3JkIEhhc8WC
byB1enl0a293bmlrYQogICAgICogQHJldHVybiBib29sIHRydWUgamXFm2xpIHVk
YcWCbyBzacSZIHphbG9nb3dhxIcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9u
IGxvZ2luKCR1c2VybmFtZSwgJHBhc3N3b3JkKQogICAgewogICAgICAgICR0b2tl
biAgICAgICAgICA9ICR0aGlzLT5nZXRfdG9rZW4oKTsKICAgICAgICAkbG9naW5f
cG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgICAgJ3Rva2VuJyAgICAgICAgICAg
ICAgICAgPT4gJHRva2VuLAogICAgICAgICAgICAnX2V4dGVybmFsW3JlbWVtYmVy
XScgICA9PiAxLAogICAgICAgICAgICAnbmFtZScgICAgICAgICAgICAgICAgICA9
PiAkdXNlcm5hbWUsCiAgICAgICAgICAgICdwYXNzd29yZCcgICAgICAgICAgICAg
ID0+ICRwYXNzd29yZAogICAgICAgICk7CiAgICAgICAgJHRoaXMtPnBvc3QoJ3ph
bG9ndWonLCAkbG9naW5fcG9zdGRhdGEpOwogICAgICAgICRyZXN1bHQgPSBzdHJp
cG9zKCR0aGlzLT5odG1sLCAnd3lsb2d1aicpICE9PSBmYWxzZTsKICAgICAgICBp
ZiAoJHJlc3VsdCkgewogICAgICAgICAgICAkdGhpcy0+X2xvZ2dlZF9pbiA9IHRy
dWU7CiAgICAgICAgICAgICR0aGlzLT5fdG9rZW4gPSAkdG9rZW47CiAgICAgICAg
fQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgCiAgICAvKioKICAg
ICAqIFR3b3J6eSBub3d5IHN0cmltCiAgICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0
dHA6Ly9zdHJpbXMucGwvdS9zaW1pdmFyPgogICAgICogQHBhcmFtIHN0cmluZyAk
bmFtZSBOYXp3YSBub3dlZ28gc3RyaW11CiAgICAgKiBAcGFyYW0gc3RyaW5nICR0
aXRsZSBUeXR1bCBub3dlZ28gc3RyaW11CiAgICAgKiBAcGFyYW0gaW50ICRwcml2
YWN5IFByeXdhdG5vc2Mgc3RyaW11OiAwIChwdWJsaWN6bnkpIC8gMSAocG9scHJ5
d2F0bnkpIC8gMiAocHJ5d2F0bnkpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkZXNj
IE9QVElPTkFMIE9waXMgc3RyaW11IAogICAgICogQHBhcmFtIHN0cmluZyAkc2lk
ZWJhciBPUFRJT05BTCBTaWRlYmFyIHN0cmltdSAKICAgICAqIEBwYXJhbSBpbnQg
JG5zZncgT1BUSU9OQUwgMTogdHlsa28gZGxhIGRvcm9zbHljaAogICAgICogQHBh
cmFtIGludCAkZXhwb3NlZCBPUFRJT05BTCAxOiBwb2thenVqIHcgc3RyaW1pZSBn
bG93bnltCiAgICAgKiBAcGFyYW0gaW50ICRtZWRpYSBPUFRJT05BTCAxOiBwb2th
enVqIG1pbmlhdHVya2kKICAgICAqIEBwYXJhbSBpbnQgJHN0eWxlIE9QVElPTkFM
IDE6IHV6eXdhaiBzdHlsb3cgCiAgICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBqZXNs
aSB1ZGFsbyBzaWUgdXR3b3J6eWMgc3RyaW0KICAgICAqLwogICAgcHVibGljIGZ1
bmN0aW9uIGNyZWF0ZV9zdHJpbSgkbmFtZSwgJHRpdGxlLCAkcHJpdmFjeSwgJGRl
c2MgPSAnJywgJHNpZGViYXIgPSAnJywgJG5zZncgPSAwLCAkZXhwb3NlZCA9IDEs
ICRtZWRpYSA9IDEsICRzdHlsZSA9IDEpCiAgICB7CiAgICAgICAgaWYgKCEkdGhp
cy0+X2xvZ2dlZF9pbikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9u
KCJNdXNpc3ogYnljIHphbG9nb3dhbnkhIik7CiAgICAgICAgfQogICAgICAgICAK
ICAgICAgICAkc3RyaW1fcG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgJ3Rva2Vu
JyAgICAgPT4gJHRoaXMtPl90b2tlbiwKICAgICAgICAgJ25hbWUnICAgICAgPT4g
JG5hbWUsCiAgICAgICAgICd0aXRsZScgICAgID0+ICR0aXRsZSwKICAgICAgICAg
J2Rlc2NyaXB0aW9uJyA9PiAkZGVzYywKICAgICAgICAgJ3NpZGViYXInID0+ICRz
aWRlYmFyLAogICAgICAgICAncHJpdmFjeScgPT4gJHByaXZhY3ksCiAgICAgICAg
ICduc2Z3JyA9PiAkbnNmdywKICAgICAgICAgJ2V4cG9zZWQnID0+ICRleHBvc2Vk
LAogICAgICAgICAnbWVkaWEnID0+ICRtZWRpYSwKICAgICAgICAgJ3N0eWxlJyA9
PiAkc3R5bGUKICAgICAgICApOwogICAgCiAgICAgICAgICR0aGlzLT5wb3N0KCdz
dHJpbXkvZG9kYWonLCAkc3RyaW1fcG9zdGRhdGEpOwogICAgICAgICAkdG1wID0g
ZmluZF9vbmVfYmV0d2VlbigkdGhpcy0+aHRtbCwgInBhZ2VfdGVtcGxhdGUuc2Vj
dGlvbl9uYW1lID0gJyIsICInIik7CgogICAgICAgICBpZiAoJHRtcCAhPSAkbmFt
ZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgCQog
ICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAKICAgIC8qKgogICAg
ICogRWR5Y2phIG9wY2ppIHN0cmltdQogICAgICogQGF1dGhvciBTaW1pdmFyIDxo
dHRwOi8vc3RyaW1zLnBsL3Uvc2ltaXZhcj4KICAgICAqIEByZXF1aXJlZCBQcmF3
YSBtb2RlcmF0b3JhIHcgZGFueW0gc3RyaW1pZS4KICAgICAqIEBwYXJhbSBzdHJp
bmcgJHN0cmltIE5hendhIHN0cmltdSB3IGt0b3J5bSB6bWllbmljIG9wY2plLgog
ICAgICogQHBhcmFtIG51bGx8Ym9vbCAkbnNmdyBUeWxrbyBkbGEgZG9yb3NseWNo
LCBudWxsIGplemVsaSBuaWUgCiAgICAgKiBjaGNlc3ogem1pZW5pYWMgdGVqIG9w
Y2ppLCAwIHd5bGFjemVuaWUsIDEgd2xhY3plbmllLgogICAgICogQHBhcmFtIG51
bGx8Ym9vbCAkZXhwb3NlZCBQb2thenVqIHcgc3RyaW1pZSBnbG93bnltLCBudWxs
IGplemVsaSBuaWUgCiAgICAgKiBjaGNlc3ogem1pZW5pYWMgdGVqIG9wY2ppLCAw
IHd5bGFjemVuaWUsIDEgd2xhY3plbmllLgogICAgICogQHBhcmFtIG51bGx8Ym9v
bCAkbWVkaWEgUG9rYXp1aiBtaW5pYXR1cnksIG51bGwgamV6ZWxpIG5pZSAKICAg
ICAqIGNoY2VzeiB6bWllbmlhYyB0ZWogb3BjamksIDAgd3lsYWN6ZW5pZSwgMSB3
bGFjemVuaWUuCiAgICAgKiBAcGFyYW0gbnVsbHxib29sICRzdHlsZSBVenl3YW5p
ZSBzdHlsaSwgbnVsbCBqZXplbGkgbmllIAogICAgICogY2hjZXN6IHptaWVuaWFj
IHRlaiBvcGNqaSwgMCB3eWxhY3plbmllLCAxIHdsYWN6ZW5pZS4KICAgICAqIEBy
ZXR1cm4gbnVsbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZWRpdF9zdHJp
bV9vcHRpb25zKCAkc3RyaW0sICRuc2Z3ICA9IE5VTEwsICRleHBvc2VkICA9IE5V
TEwsICRtZWRpYSAgPSBOVUxMLCAkc3R5bGUgID0gTlVMTCApCiAgICB7CiAgICAg
ICAgaWYgKCEkdGhpcy0+X2xvZ2dlZF9pbikgewogICAgICAgICAgICB0aHJvdyBu
ZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnljIHphbG9nb3dhbnkhIik7CiAgICAgICAg
fQogICAgICAgICR0aGlzLT5nZXQoICdzLycgLiAkc3RyaW0gLiAnL3VzdGF3aWVu
aWEnICk7CiAgICAgICAgCiAgICAgICAgLyogU3ByYXdkemFteSBjenkgdXp5dGtv
d25payBjaGNlIHptaWVuaWMgZGFuYSBvcGNqZSwgamV6ZWxpIG5pZSAtIHBvYmll
cmFteSBzdGFyYSB3YXJ0b3NjICovCiAgICAgICAgaWYgKCFpc19udWxsKCRuc2Z3
KSkKICAgICAgICAgICAgJHBvc3RkYXRhWyduc2Z3J10gPSAkbnNmdzsKICAgICAg
ICBlbHNlIHsKICAgICAgICAgICAgJG5zZndfc3RhdGUgPSBmaW5kX29uZV9iZXR3
ZWVuKCR0aGlzLT5odG1sLCAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iaW5w
dXRfbnNmdyIgbmFtZT0ibnNmdyIgdmFsdWU9IjEiIGNsYXNzPSJpbnB1dF9jaGVj
a2JveCInLCAnIC8+Jyk7CiAgICAgICAgICAgICRwb3N0ZGF0YVsnbnNmdyddID0g
KCRuc2Z3X3N0YXRlID09PSBGQUxTRSkgPyAxIDogMDsKICAgICAgICB9CiAgICAg
ICAgCiAgICAgICAgaWYoICFpc19udWxsKCAkZXhwb3NlZCApICkKICAgICAgICAg
ICAgJHBvc3RkYXRhWydleHBvc2VkJ10gPSAkZXhwb3NlZDsKICAgICAgICBlbHNl
IHsKICAgICAgICAgICAgJGV4cG9zZWRfc3RhdGUgPSBmaW5kX29uZV9iZXR3ZWVu
KCAkdGhpcy0+aHRtbCwgJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImlucHV0
X21haW4iIG5hbWU9ImV4cG9zZWQiIHZhbHVlPSIxIiBjbGFzcz0iaW5wdXRfY2hl
Y2tib3giJywgJyAvPicgKTsKICAgICAgICAgICAgJHBvc3RkYXRhWydleHBvc2Vk
J10gPSAoJGV4cG9zZWRfc3RhdGUgPT09IEZBTFNFKSA/IDEgOiAwOyAgICAgICAg
ICAgIAogICAgICAgIH0KICAgIAogICAgICAgIGlmKCAhaXNfbnVsbCggJG1lZGlh
ICkgKQogICAgICAgICAgICAkcG9zdGRhdGFbJ21lZGlhJ10gPSAkbWVkaWE7CiAg
ICAgICAgZWxzZSB7CiAgICAgICAgICAgICRtZWRpYV9zdGF0ZSA9IGZpbmRfb25l
X2JldHdlZW4oICR0aGlzLT5odG1sLCAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBp
ZD0iaW5wdXRfbWVkaWEiIG5hbWU9Im1lZGlhIiB2YWx1ZT0iMSIgY2xhc3M9Imlu
cHV0X2NoZWNrYm94IicsICcgLz4nICk7CiAgICAgICAgICAgICRwb3N0ZGF0YVsn
bWVkaWEnXSA9ICgkbWVkaWFfc3RhdGUgPT09IEZBTFNFKSA/IDEgOiAwOyAgICAg
ICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAgIAogICAgICAgIGlmKCAh
aXNfbnVsbCggJHN0eWxlICkgKQogICAgICAgICAgICAkcG9zdGRhdGFbJ3N0eWxl
J10gPSAkc3R5bGU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRzdHlsZV9z
dGF0ZSA9IGZpbmRfb25lX2JldHdlZW4oICR0aGlzLT5odG1sLCAnPGlucHV0IHR5
cGU9ImNoZWNrYm94IiBpZD0iaW5wdXRfc3R5bGUiIG5hbWU9InN0eWxlIiB2YWx1
ZT0iMSIgY2xhc3M9ImlucHV0X2NoZWNrYm94IicsICcgLz4nICk7CiAgICAgICAg
ICAgICRwb3N0ZGF0YVsnc3R5bGUnXSA9ICgkc3R5bGVfc3RhdGUgPT09IEZBTFNF
KSA/IDEgOiAwOyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAg
IAogICAgICAgICRwb3N0ZGF0YVsndG9rZW4nXSA9ICR0aGlzLT5fdG9rZW47CiAg
ICAgICAgJHRoaXMtPnBvc3QoJ3MvJy4kc3RyaW0uJy91c3Rhd2llbmlhJywgJHBv
c3RkYXRhLCB0cnVlKTsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIEVk
eWNqYSB0ZWtzdG93eWNoIHVzdGF3aWVuIHN0cmltdQogICAgICogQGF1dGhvciBT
aW1pdmFyIDxodHRwOi8vc3RyaW1zLnBsL3Uvc2ltaXZhcj4KICAgICAqIEByZXF1
aXJlZCBQcmF3YSBtb2RlcmF0b3JhIHcgZGFueW0gc3RyaW1pZS4KICAgICAqIEBw
YXJhbSBzdHJpbmcgJHRpdGxlIFR5dHVsIHN0cmltdSwgbnVsbCBkbGEgYnJha3Ug
em1pYW4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRlc2MgT3BpcyBzdHJpbXUsIG51
bGwgZGxhIGJyYWt1IHptaWFuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWRlYmFy
IFNpZGViYXIgc3RyaW11LCBudWxsIGRsYSBicmFrdSB6bWlhbgogICAgICogQHJl
dHVybiBudWxsCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0X3N0cmlt
X3RleHQoICRzdHJpbSwgJHRpdGxlID0gTlVMTCwgJGRlc2MgPSBOVUxMLCAkc2lk
ZWJhciA9IE5VTEwgKQogICAgIHsKICAgICAJaWYgKCEkdGhpcy0+X2xvZ2dlZF9p
bikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnlj
IHphbG9nb3dhbnkhIik7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5nZXQoICdz
LycgLiAkc3RyaW0gLiAnL3VzdGF3aWVuaWEnICk7CiAgICAKICAgICAgICBpZigg
IWlzX251bGwoICR0aXRsZSApICkKICAgICAgICAgICAgJHBvc3RkYXRhWyd0aXRs
ZSddID0gJHRpdGxlOwogICAgICAgICAgICAKICAgICAgICBpZiggIWlzX251bGwo
ICRkZXNjICkgKQogICAgICAgICAgICAkcG9zdGRhdGFbJ2Rlc2NyaXB0aW9uJ10g
PSAkZGVzYzsKICAgIAogICAgICAgIGlmKCAhaXNfbnVsbCggJHNpZGViYXIgKSAp
CiAgICAgICAgICAgICRwb3N0ZGF0YVsnc2lkZWJhciddID0gJHNpZGViYXI7Cgkg
CiAgICAgICAgJHBvc3RkYXRhWyd0b2tlbiddID0gJHRoaXMtPl90b2tlbjsKICAg
ICAgICAkdGhpcy0+cG9zdCgncy8nLiRzdHJpbS4nL3VzdGF3aWVuaWEnLCAkcG9z
dGRhdGEsIHRydWUpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFBvYmllcmFu
aWUgd3Bpc8OzdwogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJp
bXMucGwvdS9hbHRydWlzdGE+CiAgICAgKiBAcGFyYW0gYm9vbHxzdHJpbmcgJHN0
cmltIHNrYWQgd3Bpc3kgbnAuICJzL0NpZWthd29zdGtpIiwgInUvVXp5dGtvd25p
ayIgbHViIGZhbHNlIGplxZtsaSBnxYLDs3duZSB3cGlzeQogICAgICogQHBhcmFt
IGludCAkcGFnZSBudW1lciBzdHJvbnkgemFjenluYWphxIcgb2QgMQogICAgICog
QHJldHVybiBhcnJheSBUYWJsaWNhIHogd3luaWthbWkKICAgICAqLwogICAgcHVi
bGljIGZ1bmN0aW9uIGdldF9lbnRyaWVzKCRzdHJpbSA9IGZhbHNlLCAkcGFnZSA9
IDEpCiAgICB7CiAgICAgICAgJHRoaXMtPmdldCgkc3RyaW0gLiAnL3dwaXN5JyAu
ICgkcGFnZSA9PSAxID8gIiIgOiAiP3N0cm9uYT17JHBhZ2V9IikpOwogICAgICAg
ICR0bXAgPSBmaW5kX2JldHdlZW4oJHRoaXMtPmh0bWwsICdlbnRyeSAgIGxldmVs
XzAnLCAnPC91bCcpOwogICAgICAgIAogICAgICAgICRlbnRyaWVzID0gQXJyYXko
KTsKICAgICAgICBmb3JlYWNoICgkdG1wIGFzICRkaXYpIHsKICAgICAgICAgICAg
JGRpdl91c2VyID0gZmluZF9vbmVfYmV0d2VlbigkZGl2LCAnPGRpdiBjbGFzcz0i
ZW50cnlfdXNlciI+JywgJzwvYT4nKTsKICAgICAgICAgICAgJGRpdl9pbmZvID0g
ZmluZF9vbmVfYmV0d2VlbigkZGl2LCAnZW50cnlfaW5mbycsIGZhbHNlKTsKCiAg
ICAgICAgICAgICRlbnRyeSA9IChPYmplY3QpIEFycmF5KAogICAgICAgICAgICAg
ICAgJ3VzZXInICA9PiBmaW5kX29uZV9iZXR3ZWVuKCRkaXZfdXNlciwgJzxzcGFu
IGNsYXNzPSJib2xkIj4nLCAnPC9zcGFuPicpLAogICAgICAgICAgICAgICAgJ2lk
JyAgICA9PiBmaW5kX29uZV9iZXR3ZWVuKCRkaXYsICc8YSBpZD0iJywgJyIgY2xh
c3M9ImFuY2hvciI+PC9hPicpLAogICAgICAgICAgICAgICAgJ2h0bWwnICA9PiBm
aW5kX29uZV9iZXR3ZWVuKCRkaXYsICdkaXYgY2xhc3M9Im1hcmtkb3duIj4nLCAn
PC9kaXY+JyksCiAgICAgICAgICAgICAgICAnc3RyaW0nID0+IGZpbmRfb25lX2Jl
dHdlZW4oJGRpdl9pbmZvLCAnaHJlZj0iL3MvJywgJy8nKQogICAgICAgICAgICAp
OwogICAgICAgICAgICAkZW50cnktPnRleHQgPSBzdHJpcF90YWdzKCRlbnRyeS0+
aHRtbCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkZW50cmllc1tdID0gJGVu
dHJ5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGVudHJpZXM7CiAgICB9CiAg
ICAKICAgIC8qKgogICAgICogUG9iaWVyYW5pZSB0cmXFm2NpIHplIHN0cmltdQog
ICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0dHA6Ly9zdHJpbXMucGwvdS9hbHRy
dWlzdGE+IAogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW0gbmF6d2Egc3RyaW11
IG5wLiAicy9DaWVrYXdvc3RraSIsICJzL0NpZWthd29zdGtpL25ham5vd3N6ZSIK
ICAgICAqIEBwYXJhbSBpbnQgJHBhZ2UgbnVtZXIgc3Ryb255CiAgICAgKiBAcmV0
dXJuIGFycmF5IHRhYmxpY2EgeiB3eW5pa2FtaQogICAgICovCiAgICBwdWJsaWMg
ZnVuY3Rpb24gZ2V0X2xpc3RpbmdzKCRzdHJpbSwgJHBhZ2UgPSAxKQogICAgewog
ICAgICAgICR0aGlzLT5nZXQoJHN0cmltIC4gKCRwYWdlID09IDEgPyAiIiA6ICI/
c3Ryb25hPXskcGFnZX0iKSk7CiAgICAgICAgCiAgICAgICAgJHRtcCA9IGZpbmRf
YmV0d2VlbigkdGhpcy0+aHRtbCwgJzxkaXYgY2xhc3M9ImNvbnRlbnQgbGV2ZWxf
MCcsICc8dWwgY2xhc3M9ImNvbnRlbnRfaW5mb19hY3Rpb25zJyk7CiAgICAgICAg
CiAgICAgICAgJGxpc3RpbmdzID0gQXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgk
dG1wIGFzICRjb250ZW50KSB7CiAgICAgICAgICAgICR0aXRsZSA9IGZpbmRfb25l
X2JldHdlZW4oJGNvbnRlbnQsICc8YSBjbGFzcz0iY29udGVudF90aXRsZScsICc+
Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkbGlzdGluZyA9IChPYmplY3Qp
IEFycmF5KAogICAgICAgICAgICAgICAgJ3RpdGxlJyAgICAgICAgID0+IGZpbmRf
b25lX2JldHdlZW4oJGNvbnRlbnQsICd0aXRsZT0iJywgJyInKSwKICAgICAgICAg
ICAgICAgICd0aHVtYicgICAgICAgICA9PiBmaW5kX29uZV9iZXR3ZWVuKCRjb250
ZW50LCAnPGltZyBzcmM9IicsICciJyksCiAgICAgICAgICAgICAgICAnaWQnICAg
ICAgICAgICAgPT4gZmluZF9vbmVfYmV0d2VlbigkY29udGVudCwgJ3JlZj0iL2Fq
YXgvdC8nLCAnL2x1YmknKSwgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg
ICAnbGluaycgICAgICAgICAgPT4gZmluZF9vbmVfYmV0d2VlbigkdGl0bGUsICdo
cmVmPSInLCAnIicpICAgICAgICAgICAgICAgIAogICAgICAgICAgICApOyAgICAg
ICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLyogVE9ETzogRklYTUU6IHcg
emFsZcW8bm/Fm2NpIG9kIHRlZ28gY3p5IGplc3RlxZtteSB6YWxvZ293YW5pIGkg
bWFteSB3IHVzdGF3aWVuaWFjaAogICAgICAgICAgICAgKiB3xYLEhWN6b25lIHJh
bWtpIHRlIHd5bmlraSBixJlkYSBzacSZwqByw7PFvG5pxIcuIHRyICovICAgICAg
ICAgICAgICAgIAogICAgICAgICAgICAkbGlzdGluZy0+ZXh0ZXJuYWxfdXJsID0g
JGxpc3RpbmctPmxpbms7CiAgICAgICAgICAgICRsaXN0aW5nLT5mcmFtZV91cmwg
PSAkbGlzdGluZy0+bGluazsKICAgICAgICAgICAgCiAgICAgICAgICAgICRsaXN0
aW5nLT5zdHJpbXNfc2hvcnRfdXJsID0gImh0dHA6Ly9zdHJpbXMucGwvdC97JGxp
c3RpbmctPmxpbmt9IjsKICAgICAgICAgICAgLy8kbGlzdGluZy0+c3RyaW1zX2Z1
bGxfdXJsID0gbnVsbDsgLyogVE9ETywgbmEgcGV3bm9lIG5pZSBtYSBzZW5zdSB1
xbx5d2HEhyBnZXRfZnVsbF9sb2NhdGlvbigpICovICAgICAgICAgICAgCiAgICAg
ICAgICAgIAogICAgICAgICAgICAkbGlzdGluZ3NbXSA9ICRsaXN0aW5nOwogICAg
ICAgIH0KICAgICAgICByZXR1cm4gJGxpc3RpbmdzOwogICAgfQogICAgCiAgICAv
KioKICAgICAqIERvZGF3YW5pZSB3cGlzdQogICAgICogQGF1dGhvciBBbHRydWlz
dGEgPGh0dHA6Ly9zdHJpbXMucGwvdS9hbHRydWlzdGE+CiAgICAgKiBAcGFyYW0g
Ym9vbHxzdHJpbmcgJHN0cmltIGRva2FkIHdwaXMgbnAuICJDaWVrYXdvc3RraSIg
bHViIGZhbHNlIGplxZtsaSBkbyBnxYLDs3duZWdvIAogICAgICogQHBhcmFtIHN0
cmluZyAkY29udGVudCBUcmXFm8SHIHdwaXN1CiAgICAgKiBAcmV0dXJuIG9iamVj
dCBvZHBvd2llZMW6IGFqYXggemUgc3RyaW1zYQogICAgICovCiAgICBwdWJsaWMg
ZnVuY3Rpb24gcG9zdF9lbnRyeSgkc3RyaW0sICRjb250ZW50KQogICAgewogICAg
ICAgIGlmICghJHRoaXMtPl9sb2dnZWRfaW4pIHsKICAgICAgICAgICAgdGhyb3cg
bmV3IEV4Y2VwdGlvbigiTXVzaXN6IGJ5YyB6YWxvZ293YW55ISIpOwogICAgICAg
IH0KICAgICAgICAkZW50cnlfcG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgICAg
J3Rva2VuJyAgICAgICAgICAgICA9PiAkdGhpcy0+X3Rva2VuLAogICAgICAgICAg
ICAnX2V4dGVybmFsW3BhcmVudF0nID0+ICcnLAogICAgICAgICAgICAndGV4dCcg
ICAgICAgICAgICAgID0+ICRjb250ZW50LAogICAgICAgICAgICAnX2V4dGVybmFs
W3N0cmltXScgID0+ICRzdHJpbQogICAgICAgICk7CiAgICAgICAgJHJlc3VsdCA9
ICR0aGlzLT5wb3N0KCdhamF4L3dwaXN5L2RvZGFqJywgJGVudHJ5X3Bvc3RkYXRh
LCB0cnVlKTsKICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHJlc3VsdCk7CiAg
ICB9CiAgICAKICAgIC8qKgogICAgICogRG9kYXdhbmllIG9kcG93aWVkemkgZG8g
d3Bpc3UKICAgICAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRwOi8vc3RyaW1zLnBs
L3UvYWx0cnVpc3RhPgogICAgICogQHBhcmFtIHN0cmluZyAkZW50cnlfaWQgaWQg
d3Bpc3UgbnAuICdmZ3NkMjM0JwogICAgICogQHBhcmFtIHN0cmluZyAkY29udGVu
dCBUcmXFm8SHIHdwaXN1IChvZHBvd2llZHppKQogICAgICogQHJldHVybiBvYmpl
Y3Qgb2Rwb3dpZWTFuiBhamF4IHplIHN0cmltc2EKICAgICAqLwogICAgcHVibGlj
IGZ1bmN0aW9uIHBvc3RfZW50cnlfYW5zd2VyKCRlbnRyeV9pZCwgJGNvbnRlbnQp
CiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2xvZ2dlZF9pbikgewogICAgICAg
ICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnljIHphbG9nb3dhbnkh
Iik7CiAgICAgICAgfQogICAgICAgICRlbnRyeV9wb3N0ZGF0YSA9IEFycmF5KAog
ICAgICAgICAgICAndG9rZW4nICAgICAgICAgICAgID0+ICR0aGlzLT5fdG9rZW4s
CiAgICAgICAgICAgICdfZXh0ZXJuYWxbcGFyZW50XScgPT4gJGVudHJ5X2lkLAog
ICAgICAgICAgICAndGV4dCcgICAgICAgICAgICAgID0+ICRjb250ZW50CiAgICAg
ICAgKTsKICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPnBvc3QoJ2FqYXgvd3Bpc3kv
ZG9kYWonLCAkZW50cnlfcG9zdGRhdGEsIHRydWUpOwogICAgICAgIHJldHVybiBq
c29uX2RlY29kZSgkcmVzdWx0KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBE
b2Rhd2FuaWUgdHJlxZtjaSAobGluaykKICAgICAqIEBhdXRob3IgQWx0cnVpc3Rh
IDxodHRwOi8vc3RyaW1zLnBsL3UvYWx0cnVpc3RhPgogICAgICogQHBhcmFtIHN0
cmluZyAkc3RyaW0gZG9rYWQgd3BpcyBucC4gIkNpZWthd29zdGtpIgogICAgICog
QHBhcmFtIHN0cmluZyAkdGl0bGUgdHl0dcWCCiAgICAgKiBAcGFyYW0gc3RyaW5n
ICR1cmwgdXJsIG9kbm/Fm25pa2EKICAgICAqIEBwYXJhbSBib29sICR0aHVtYiBt
aW5pYXR1cmthIHRydWUvZmFsc2UgICAgIAogICAgICogQHJldHVybiBib29sfHN0
cmluZyBpZCB0cmVzY2kgbHViIGZhbHN6IHcgcHJ6eXBhZGt1IG5pZXBvd29kemVu
aWEKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBvc3RfbGluaygkc3RyaW0s
ICR0aXRsZSwgJHVybCwgJHRodW1iID0gdHJ1ZSkKICAgIHsKICAgICAgICBpZiAo
ISR0aGlzLT5fbG9nZ2VkX2luKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNl
cHRpb24oIk11c2lzeiBieWMgemFsb2dvd2FueSEiKTsKICAgICAgICB9CiAgICAg
ICAgJGxpbmtfcG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgICAgJ3Rva2VuJyAg
ICAgICAgICAgICA9PiAkdGhpcy0+X3Rva2VuLAogICAgICAgICAgICAna2luZCcg
ICAgICAgICAgICAgID0+ICdsaW5rJywKICAgICAgICAgICAgJ3RpdGxlJyAgICAg
ICAgICAgICA9PiAkdGl0bGUsCiAgICAgICAgICAgICd1cmwnICAgICAgICAgICAg
ICAgPT4gJHVybCwKICAgICAgICAgICAgJ3RleHQnICAgICAgICAgICAgICA9PiAn
JywKICAgICAgICAgICAgJ19leHRlcm5hbFtzdHJpbV0nICA9PiAkc3RyaW0sCiAg
ICAgICAgICAgICdtZWRpYScgICAgICAgICAgICAgPT4gJHRodW1iID8gMSA6IDAK
ICAgICAgICApOwogICAgICAgICR0aGlzLT5wb3N0KCdzLycgLiAkc3RyaW0gLiAn
L2RvZGFqJywgJGxpbmtfcG9zdGRhdGEpOwogICAgICAgICR0bXAgPSBmaW5kX29u
ZV9iZXR3ZWVuKCR0aGlzLT5odG1sLCAnY29udGVudCBsZXZlbF8wJywgJzwvYT4n
KTsKICAgICAgICAKICAgICAgICBpZiAoISR0bXApIHsKICAgICAgICAgICAgcmV0
dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkaWQgPSBmaW5kX29uZV9iZXR3
ZWVuKCR0bXAsICdpZD0iJywgJyInKTsKICAgICAgICBpZiAoISRpZCkgewogICAg
ICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiAk
aWQ7CiAgICB9CiAgICAKICAgICAvKioKICAgICAgKiBEb2Rhd2FuaWUgdHJlxZtj
aSAodGV4dCkKICAgICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0dHA6Ly9zdHJpbXMu
cGwvdS9zaW1pdmFyPgogICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmltIGRva2Fk
IHdwaXMgbnAuICJDaWVrYXdvc3RraSIKICAgICAgKiBAcGFyYW0gc3RyaW5nICR0
aXRsZSB0eXR1xYIKICAgICAgKiBAcGFyYW0gc3RyaW5nICRjb250ZW50IHphd2Fy
dG9zYyB3cGlzdQogICAgICAqIEBwYXJhbSBib29sICR0aHVtYiBtaW5pYXR1cmth
IHRydWUvZmFsc2UgICAgIAogICAgICAqIEByZXR1cm4gYm9vbHxzdHJpbmcgaWQg
dHJlc2NpIGx1YiBmYWxzeiB3IHByenlwYWRrdSBuaWVwb3dvZHplbmlhCiAgICAg
ICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9zdF90ZXh0KCRzdHJpbSwgJHRpdGxl
LCAkY29udGVudCwgJHRodW1iID0gdHJ1ZSkKICAgIHsKICAgICAgICBpZiAoISR0
aGlzLT5fbG9nZ2VkX2luKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRp
b24oIk11c2lzeiBieWMgemFsb2dvd2FueSEiKTsKICAgICAgICB9CiAgICAgICAg
JGxpbmtfcG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgICAgJ3Rva2VuJyAgICAg
ICAgICAgICA9PiAkdGhpcy0+X3Rva2VuLAogICAgICAgICAgICAna2luZCcgICAg
ICAgICAgICAgID0+ICd0ZXh0JywKICAgICAgICAgICAgJ3RpdGxlJyAgICAgICAg
ICAgICA9PiAkdGl0bGUsCiAgICAgICAgICAgICdsaW5rJwkgICAgICAgID0+ICcn
LAogICAgICAgICAgICAndGV4dCcgICAgICAgICAgICAgID0+ICRjb250ZW50LAog
ICAgICAgICAgICAnX2V4dGVybmFsW3N0cmltXScgID0+ICRzdHJpbSwKICAgICAg
ICAgICAgJ21lZGlhJyAgICAgICAgICAgICA9PiAkdGh1bWIgPyAxIDogMAogICAg
ICAgICk7CiAgICAgICAgJHRoaXMtPnBvc3QoJ3MvJyAuICRzdHJpbSAuICcvZG9k
YWonLCAkbGlua19wb3N0ZGF0YSk7CiAgICAgICAgJHRtcCA9IGZpbmRfb25lX2Jl
dHdlZW4oJHRoaXMtPmh0bWwsICdjb250ZW50IGxldmVsXzAnLCAnPC9hPicpOwog
ICAgICAgIAogICAgICAgIGlmICghJHRtcCkgewogICAgICAgICAgICByZXR1cm4g
ZmFsc2U7CiAgICAgICAgfQogICAgICAgICRpZCA9IGZpbmRfb25lX2JldHdlZW4o
JHRtcCwgJ2lkPSInLCAnIicpOwogICAgICAgIGlmICghJGlkKSB7CiAgICAgICAg
ICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRpZDsK
ICAgIH0KICAgIAogICAgIC8qKgogICAgICogRG9kYWplIGV0eWtpZXRlIGRvIHRy
ZXNjaQogICAgICogQGF1dGhvciBTaW1pdmFyIDxodHRwOi8vc3RyaW1zLnBsL3Uv
c2ltaXZhcj4KICAgICAqIEByZXF1aXJlZCBQcmF3YSBtb2RlcmF0b3JhIC8gYnlj
aWUgYXV0b3JlbSB0cmVzY2kKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmltIGRv
a2FkIGV0eWtpZXRhIG5wLiAiQ2lla2F3b3N0a2kiCiAgICAgKiBAcGFyYW0gc3Ry
aW5nICRsaW5rX2lkIGlkIGxpbmt1IG5wLiAnYnNseWt0JwogICAgICogQHBhcmFt
IGludCAkbGFiZWxfaWQgaWQgZXR5a2lldHkgbnAuIDU0NAogICAgICogQHJldHVy
biBzdHJpbmd8Ym9vbCBrbGFzYSBldHlraWV0eSBsdWIgZmFsc3ogdyBwcnp5cGFk
a3UgbmllcG93b2R6ZW5pYQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRk
X2xhYmVsKCRzdHJpbSwgJGxpbmtfaWQsICRsYWJlbF9pZCkKICAgIHsKICAgICAg
ICBpZiAoISR0aGlzLT5fbG9nZ2VkX2luKSB7CiAgICAgICAgICAgIHRocm93IG5l
dyBFeGNlcHRpb24oIk11c2lzeiBieWMgemFsb2dvd2FueSEiKTsKICAgICAgICB9
CiAgICAgICAgIAogICAgCSRsYWJlbF9wb3N0ZGF0YSA9IGFycmF5KAogICAgICAg
ICAgICAndG9rZW4nICAgICAgICAgICAgID0+ICR0aGlzLT5fdG9rZW4sCiAgICAg
ICAgICAgICdzdHJpbV9mbGFpcl9pZCcgICAgPT4gJGxhYmVsX2lkCiAgICAJKTsK
ICAgIAkKICAgIAkkdGl0bGUgPSAkdGhpcy0+Z2V0X3RpdGxlKCdzLycgLiAkc3Ry
aW0gLiAnL3QvJyAuICRsaW5rX2lkKTsKICAgIAogICAgCSR0aGlzLT5wb3N0KCdz
LycgLiAkc3RyaW0gLiAnL3QvJyAuICRsaW5rX2lkIC4gJy9ldHlraWV0YScgLiAk
dGl0bGUsICRsYWJlbF9wb3N0ZGF0YSk7CiAgICAgICAgJHRtcCA9IGZpbmRfb25l
X2JldHdlZW4oJHRoaXMtPmh0bWwsICdjb250ZW50IGxldmVsXzAnLCAnIj4nKTsK
ICAgIAkKICAgIAlpZiAoISR0bXApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNl
OwogICAgICAgIH0KICAgIAkKICAgIAkkbGFiZWwgPSBzdHJfcmVwbGFjZSgnZmxh
aXJfJywgJycsIGZpbmRfb25lX2JldHdlZW4oICR0bXAsICdmbGFpciAnLCAnIGNs
ZWFyJyApKTsKICAgIAkKICAgIAlpZiAoISRsYWJlbCkgewogICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgCQogICAgCXJldHVybiAkbGFiZWw7
CiAgICB9CiAgICAKICAgICAvKioKICAgICAqIFR3b3J6eSBldHlraWV0ZSB3IHN0
cmltaWUKICAgICAqIEBhdXRob3IgU2ltaXZhciA8aHR0cDovL3N0cmltcy5wbC91
L3NpbWl2YXI+CiAgICAgKiBAcmVxdWlyZWQgUHJhd2EgbW9kZXJhdG9yYSB3IHN0
cmltaWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmltIGRva2FkIGV0eWtpZXRh
IG5wLiAiQ2lla2F3b3N0a2kiCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lIG5h
endhIGV0eWtpZXR5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRjc3NfY2xhc3Mga2xh
c2EgY3NzIGV0eWtpZXR5CiAgICAgKiBAcmV0dXJuIHN0cmluZ3xib29sIElEIGV0
eWtpZXR5IGx1YiBmYWxzeiB3IHByenlwYWRrdSBuaWVwb3dvZHplbmlhCiAgICAg
Ki8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVfbGFiZWwoJHN0cmltLCAkbmFt
ZSwgJGNzc19jbGFzcyA9ICcnKQogICAgewogICAgICAgIGlmICghJHRoaXMtPl9s
b2dnZWRfaW4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiTXVz
aXN6IGJ5YyB6YWxvZ293YW55ISIpOwogICAgICAgIH0KICAgICAgICAgCiAgICAg
ICAgJGxhYmVsX3Bvc3RkYXRhID0gQXJyYXkoCiAgICAgICAgICAgICd0b2tlbicg
ICAgID0+ICR0aGlzLT5fdG9rZW4sCiAgICAgICAgICAgICduYW1lJyAgICAgID0+
ICRuYW1lLAogICAgICAgICAgICAnY2xhc3MnICAgICA9PiAkY3NzX2NsYXNzLAog
ICAgICAgICAgICAnYWN0aW9uJyAgICA9PiAnYWRkJwogICAgICAgICk7CiAgICAK
ICAgIAkkdGhpcy0+cG9zdCgncy8nIC4gJHN0cmltIC4gJy9ldHlraWV0eScsICRs
YWJlbF9wb3N0ZGF0YSk7CiAgICAgICAgJHRtcCA9IGZpbmRfb25lX2JldHdlZW4o
JHRoaXMtPmh0bWwsICRjc3NfY2xhc3MsICc8L3RyJyk7CgogICAgICAgIGlmICgh
JHRtcCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAg
CQogICAgICAgICRsYWJlbF9pZCA9IGZpbmRfb25lX2JldHdlZW4oJHRtcCwgJ2Eg
aHJlZj0iL3MvJyAuICRzdHJpbSAuICcvZXR5a2lldGE/aWQ9JywgJyInKTsKCiAg
ICAgICAgaWYgKCEkbGFiZWxfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNl
OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRsYWJlbF9pZDsKICAgIH0KICAg
IAogICAgLyoqCiAgICAgKiBEb2RhamUgbGluayBkbyBwb3dpxIV6YW55Y2gKICAg
ICAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRwOi8vc3RyaW1zLnBsL3UvYWx0cnVp
c3RhPgogICAgICogQHBhcmFtIHN0cmluZyAkbGlua19pZCBpZCBsaW5rdSBucC4g
J2ZmYTUyMycKICAgICAqIEBwYXJhbSBzdHJpbmcgJHRpdGxlIHR5dHXFggogICAg
ICogQHBhcmFtIHN0cmluZyAkdXJsIHVybCBsaW5rdQogICAgICogQHBhcmFtIGJv
b2wgJHRodW1iIG1pbmlhdHVya2EgCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlv
biBhZGRfcmVsYXRlZF9saW5rKCRsaW5rX2lkLCAkdGl0bGUsICR1cmwsICR0aHVt
YiA9IHRydWUpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2xvZ2dlZF9pbikg
ewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnljIHph
bG9nb3dhbnkhIik7CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgJHJlbGF0ZWRf
cG9zdGRhdGEgPSBBcnJheSgKICAgICAgICAgICAgJ3Rva2VuJyA9PiAkdGhpcy0+
X3Rva2VuLAogICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAg
ICAgJ3VybCcgICA9PiAkdXJsLAogICAgICAgICAgICAnbWVkaWEnID0+ICR0aHVt
YiA/IDEgOiAwCiAgICAgICAgKTsKICAgICAgICAKICAgICAgICAvLyBhYnkgZG9k
YcSHIHBvd2nEhXphbnkgbGluayB0cnplYmEgem5hxIcgcGXFgmVuIFVSTCB0cmXF
m2NpCiAgICAgICAgLy8gbnAuIHMvbmF6d2Ffc3RyaW11L3QvNTIzZnNkL3R5dHVs
LXRlai10cmVzY2kKICAgICAgICAkZnVsbF9sb2NhdGlvbiA9ICR0aGlzLT5nZXRf
ZnVsbF9sb2NhdGlvbigidC97JGxpbmtfaWR9Iik7CiAgICAgICAgCiAgICAgICAg
Ly8gdHdvcnp5bXkgbG9rYWNqZSBkbyB3eXPFgmFuaWEgUE9TVCBhYnkgZG9kYcSH
IHBvd2nEhXphbnkgbGluawogICAgICAgICRhZGRfcmVsYXRlZF9saW5rX2xvY2F0
aW9uID0gc3RyX3JlcGxhY2UoInQveyRsaW5rX2lkfS8iLCAidC97JGxpbmtfaWR9
L3Bvd2lhemFuYS8iLCAkZnVsbF9sb2NhdGlvbik7CiAgICAgICAgCiAgICAgICAg
JHRoaXMtPnBvc3QoJGFkZF9yZWxhdGVkX2xpbmtfbG9jYXRpb24sICRyZWxhdGVk
X3Bvc3RkYXRhKTsgICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAgICAqIFph
dHdpZXJkemFuaWUgdHJlc2NpL2tvbWVudGFyemEvd3Bpc3UgdyBzdHJpbWllCiAg
ICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0dHA6Ly9zdHJpbXMucGwvdS9zaW1pdmFy
PgogICAgICogQHJlcXVpcmVkIFByYXdhIG1vZGVyYXRvcmEgdyBzdHJpbWllCiAg
ICAgKiBAcGFyYW0gc3RyaW5nICRjb250ZW50IGlkIHRyZXNjaS9rb21lbnRhcnph
L3dwaXN1ICJ0L2xubmpiOSIgbHViICJrL2oxeWU2NSIKICAgICAqIEByZXR1cm4g
b2JqZWN0IG9kcG93aWVkxbogemUgc3RyaW1zYQogICAgICovCiAgICBwdWJsaWMg
ZnVuY3Rpb24gYXBwcm92ZSgkY29udGVudCkKICAgIHsKICAgICAgICBpZiAoISR0
aGlzLT5fbG9nZ2VkX2luKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRp
b24oIk11c2lzeiBieWMgemFsb2dvd2FueSEiKTsKICAgICAgICB9CiAgICAgICAg
JHJlc3VsdCA9ICR0aGlzLT5nZXQoJ2FqYXgvJy4kY29udGVudC4nL3phdHdpZXJk
ej90b2tlbj0nLiR0aGlzLT5fdG9rZW4pOwogICAgICAgIHJldHVybiBqc29uX2Rl
Y29kZSgkcmVzdWx0KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBVc3V3YW5p
ZSB0cmVzY2kva29tZW50YXJ6YS93cGlzdSB3IHN0cmltaWUKICAgICAqIEBhdXRo
b3IgU2ltaXZhciA8aHR0cDovL3N0cmltcy5wbC91L3NpbWl2YXI+CiAgICAgKiBA
cmVxdWlyZWQgUHJhd2EgbW9kZXJhdG9yYSB3IHN0cmltaWUKICAgICAqIEBwYXJh
bSBzdHJpbmcgJGNvbnRlbnQgaWQgdHJlc2NpL2tvbWVudGFyemEvd3Bpc3UgInQv
bG5uamI5IiBsdWIgImsvajF5ZTY1IgogICAgICogQHJldHVybiBvYmplY3Qgb2Rw
b3dpZWTFuiB6ZSBzdHJpbXNhCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBy
ZW1vdmUoJGNvbnRlbnQpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2xvZ2dl
ZF9pbikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNdXNpc3og
YnljIHphbG9nb3dhbnkhIik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSAk
dGhpcy0+Z2V0KCdhamF4LycuJGNvbnRlbnQuJy9tb2RlcnVqP3Rva2VuPScuJHRo
aXMtPl90b2tlbik7CiAgICAgICAgcmV0dXJuIGpzb25fZGVjb2RlKCRyZXN1bHQp
OwogICAgfQogICAgCiAgICAvKioKICAgICAqIFN1YnNrcnlidWplIHN0cmltCiAg
ICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0dHA6Ly9zdHJpbXMucGwvdS9zaW1pdmFy
PgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW0gTmF6d2Egc3RyaW11CiAgICAg
KiBAcmV0dXJuIG9iamVjdCBvZHBvd2llZMW6IHplIHN0cmltc2EKICAgICAqLwog
ICAgcHVibGljIGZ1bmN0aW9uIHN1YnNjcmliZSgkc3RyaW0pCiAgICB7CiAgICAg
ICAgaWYgKCEkdGhpcy0+X2xvZ2dlZF9pbikgewogICAgICAgICAgICB0aHJvdyBu
ZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnljIHphbG9nb3dhbnkhIik7CiAgICAgICAg
fQogICAgICAgICRyZXN1bHQgPSAkdGhpcy0+Z2V0KCdhamF4L3MvJy4kc3RyaW0u
Jy9zdWJza3J5YnVqP3Rva2VuPScuJHRoaXMtPl90b2tlbik7CiAgICAgICAgcmV0
dXJuIGpzb25fZGVjb2RlKCRyZXN1bHQpOwogICAgfQogICAgCiAgICAvKioKICAg
ICAqIE9kc3Vic2tyeWJ1amUgc3RyaW0KICAgICAqIEBhdXRob3IgU2ltaXZhciA8
aHR0cDovL3N0cmltcy5wbC91L3NpbWl2YXI+CiAgICAgKiBAcGFyYW0gc3RyaW5n
ICRzdHJpbSBOYXp3YSBzdHJpbXUKICAgICAqIEByZXR1cm4gb2JqZWN0IG9kcG93
aWVkxbogemUgc3RyaW1zYQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdW5z
dWJzY3JpYmUoJHN0cmltKQogICAgewogICAgICAgIGlmICghJHRoaXMtPl9sb2dn
ZWRfaW4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiTXVzaXN6
IGJ5YyB6YWxvZ293YW55ISIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0g
JHRoaXMtPmdldCgnYWpheC9zLycuJHN0cmltLicvbmllc3Vic2tyeWJ1aj90b2tl
bj0nLiR0aGlzLT5fdG9rZW4pOwogICAgICAgIHJldHVybiBqc29uX2RlY29kZSgk
cmVzdWx0KTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBCbG9rdWplIHN0cmlt
CiAgICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0dHA6Ly9zdHJpbXMucGwvdS9zaW1p
dmFyPgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW0gTmF6d2Egc3RyaW11CiAg
ICAgKiBAcmV0dXJuIG9iamVjdCBvZHBvd2llZMW6IHplIHN0cmltc2EKICAgICAq
LwogICAgcHVibGljIGZ1bmN0aW9uIGJsb2NrKCRzdHJpbSkKICAgIHsKICAgICAg
ICBpZiAoISR0aGlzLT5fbG9nZ2VkX2luKSB7CiAgICAgICAgICAgIHRocm93IG5l
dyBFeGNlcHRpb24oIk11c2lzeiBieWMgemFsb2dvd2FueSEiKTsKICAgICAgICB9
CiAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5nZXQoJ2FqYXgvcy8nLiRzdHJpbS4n
L3phYmxva3VqP3Rva2VuPScuJHRoaXMtPl90b2tlbik7CiAgICAgICAgcmV0dXJu
IGpzb25fZGVjb2RlKCRyZXN1bHQpOwogICAgfQogICAgCiAgICAvKioKICAgICAq
IE9kYmxva293dWplIHN0cmltCiAgICAgKiBAYXV0aG9yIFNpbWl2YXIgPGh0dHA6
Ly9zdHJpbXMucGwvdS9zaW1pdmFyPgogICAgICogQHBhcmFtIHN0cmluZyAkc3Ry
aW0gTmF6d2Egc3RyaW11CiAgICAgKiBAcmV0dXJuIG9iamVjdCBvZHBvd2llZMW6
IHplIHN0cmltc2EKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVuYmxvY2so
JHN0cmltKQogICAgewogICAgICAgIGlmICghJHRoaXMtPl9sb2dnZWRfaW4pIHsK
ICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiTXVzaXN6IGJ5YyB6YWxv
Z293YW55ISIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmdl
dCgnYWpheC9zLycuJHN0cmltLicvb2RibG9rdWo/dG9rZW49Jy4kdGhpcy0+X3Rv
a2VuKTsKICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHJlc3VsdCk7CiAgICB9
CiAgICAKICAgIC8qKgogICAgICogVVYgd3Bpc3UvdHJlxZtjaSBucC4gJ3cvOW12
M2RiJyBsdWIgJ3QvNTIzZmFnJwogICAgICogQGF1dGhvciBBbHRydWlzdGEgPGh0
dHA6Ly9zdHJpbXMucGwvdS9hbHRydWlzdGE+CiAgICAgKiBAcGFyYW0gc3RyaW5n
ICRjb250ZW50IGlkIHdwaXN1CiAgICAgKiBAcmV0dXJuIG9iamVjdCBvZHBvd2ll
ZMW6IHplIHN0cmltc2EKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxpa2Uo
JGNvbnRlbnQpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2xvZ2dlZF9pbikg
ewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNdXNpc3ogYnljIHph
bG9nb3dhbnkhIik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSAkdGhpcy0+
Z2V0KCdhamF4LycuJGNvbnRlbnQuJy9sdWJpZT90b2tlbj0nLiR0aGlzLT5fdG9r
ZW4pOwogICAgICAgIHJldHVybiBqc29uX2RlY29kZSgkcmVzdWx0KTsKICAgIH0K
CiAgICAvKioKICAgICAqIERWIHdwaXN1L3RyZcWbY2kgbnAuICd3LzltdjNkYicg
bHViICd0LzUyM2ZhZycKICAgICAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRwOi8v
c3RyaW1zLnBsL3UvYWx0cnVpc3RhPgogICAgICogQHBhcmFtIHN0cmluZyAkY29u
dGVudCBpZCB3cGlzdQogICAgICogQHJldHVybiBvYmplY3Qgb2Rwb3dpZWTFuiB6
ZSBzdHJpbXNhCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkaXNsaWtlKCRj
b250ZW50KQogICAgewogICAgICAgIGlmICghJHRoaXMtPl9sb2dnZWRfaW4pIHsK
ICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiTXVzaXN6IGJ5YyB6YWxv
Z293YW55ISIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmdl
dCgnYWpheC8nLiRjb250ZW50LicvbmllbHViaWU/dG9rZW49Jy4kdGhpcy0+X3Rv
a2VuKTsKICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHJlc3VsdCk7CiAgICB9
CiAgICAKICAgIC8qKgogICAgICogVVYgd3Bpc3UgbnAuICc5bXYzZGInCiAgICAg
KiBAYXV0aG9yIEFsdHJ1aXN0YSA8aHR0cDovL3N0cmltcy5wbC91L2FsdHJ1aXN0
YT4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVudHJ5X2lkIGlkIHdwaXN1CiAgICAg
KiBAcmV0dXJuIG9iamVjdCBvZHBvd2llZMW6IHplIHN0cmltc2EKICAgICAqLwog
ICAgcHVibGljIGZ1bmN0aW9uIGxpa2VfZW50cnkoJGVudHJ5X2lkKQogICAgewog
ICAgICAgIHJldHVybiAkdGhpcy0+bGlrZSgidy97JGVudHJ5X2lkfSIpOwogICAg
fQoKICAgIC8qKgogICAgICogRFYgd3Bpc3UgbnAuICc5bXYzZGInCiAgICAgKiBA
YXV0aG9yIEFsdHJ1aXN0YSA8aHR0cDovL3N0cmltcy5wbC91L2FsdHJ1aXN0YT4K
ICAgICAqIEBwYXJhbSBzdHJpbmcgJGVudHJ5X2lkIGlkIHdwaXN1CiAgICAgKiBA
cmV0dXJuIG9iamVjdCBvZHBvd2llZMW6IHplIHN0cmltc2EKICAgICAqLwogICAg
cHVibGljIGZ1bmN0aW9uIGRpc2xpa2VfZW50cnkoJGVudHJ5X2lkKQogICAgewog
ICAgICAgIHJldHVybiAkdGhpcy0+ZGlzbGlrZSgidC97JGVudHJ5X2lkfSIpOwog
ICAgfQoKICAgIC8qKgogICAgICogVVYgdHJlxZtjaSBucC4gJzltdjNkYicKICAg
ICAqIEBhdXRob3IgQWx0cnVpc3RhIDxodHRwOi8vc3RyaW1zLnBsL3UvYWx0cnVp
c3RhPgogICAgICogQHBhcmFtIHN0cmluZyAkbGlua19pZCBpZCB3cGlzdQogICAg
ICogQHJldHVybiBvYmplY3Qgb2Rwb3dpZWTFuiB6ZSBzdHJpbXNhCiAgICAgKi8K
ICAgIHB1YmxpYyBmdW5jdGlvbiBsaWtlX2xpbmsoJGxpbmtfaWQpCiAgICB7CiAg
ICAgICAgcmV0dXJuICR0aGlzLT5saWtlKCJ0L3skbGlua19pZH0iKTsKICAgIH0K
CiAgICAvKioKICAgICAqIERWIHRyZcWbY2kgbnAuICc5bXYzZGInCiAgICAgKiBA
YXV0aG9yIEFsdHJ1aXN0YSA8aHR0cDovL3N0cmltcy5wbC91L2FsdHJ1aXN0YT4K
ICAgICAqIEBwYXJhbSBzdHJpbmcgJGxpbmtfaWQgaWQgd3Bpc3UKICAgICAqIEBy
ZXR1cm4gb2JqZWN0IG9kcG93aWVkxbogemUgc3RyaW1zYQogICAgICovCiAgICBw
dWJsaWMgZnVuY3Rpb24gZGlzbGlrZV9saW5rKCRsaW5rX2lkKQogICAgewogICAg
ICAgIHJldHVybiAkdGhpcy0+ZGlzbGlrZSgidC97JGxpbmtfaWR9Iik7CiAgICB9
ICAgIAp9Cj8+Cjw/cGhwCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KgogKiBGdW5rY2plIHBvbW9jbmljemUgCiAqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKi8KCi8qKgogKiBXeXdhbGEgcG9sc2tpZSB6bmFraQogKiBAbGlu
ayBodHRwOi8vcHJvZ3JhbWlzdHljem55LmJsb2dzcG90LmNvLnVrLzIwMTIvMDUv
cGhwLWphay11c3VuYWMtcG9sc2tpZS16bmFraS5odG1sCiAqIEBwYXJhbSBzdHJp
bmcgCiAqIEByZXR1cm4gc3RyaW5nIAogKi8KZnVuY3Rpb24gcmVwbGFjZV9kaWFj
cml0aWNzKCRzdHJpbmcpIHsgICAgCgogICAgJGNoYXJhY3RlcnMgPSBhcnJheSgp
OwoKICAgICRjaGFyYWN0ZXJzWyfEhCddID0gJ2EnOwogICAgJGNoYXJhY3RlcnNb
J8SGJ10gPSAnYyc7CiAgICAkY2hhcmFjdGVyc1snxJgnXSA9ICdlJzsKICAgICRj
aGFyYWN0ZXJzWyfFgSddID0gJ2wnOwogICAgJGNoYXJhY3RlcnNbJ8WDJ10gPSAn
bic7CiAgICAkY2hhcmFjdGVyc1snw5MnXSA9ICdvJzsKICAgICRjaGFyYWN0ZXJz
WyfFmiddID0gJ3MnOwogICAgJGNoYXJhY3RlcnNbJ8W7J10gPSAneic7CiAgICAk
Y2hhcmFjdGVyc1snxbknXSA9ICd6JzsKICAgICRjaGFyYWN0ZXJzWyfEhSddID0g
J2EnOwogICAgJGNoYXJhY3RlcnNbJ8SHJ10gPSAnYyc7CiAgICAkY2hhcmFjdGVy
c1snxJknXSA9ICdlJzsKICAgICRjaGFyYWN0ZXJzWyfFgiddID0gJ2wnOwogICAg
JGNoYXJhY3RlcnNbJ8WEJ10gPSAnbic7CiAgICAkY2hhcmFjdGVyc1snw7MnXSA9
ICdvJzsKICAgICRjaGFyYWN0ZXJzWyfFmyddID0gJ3MnOwogICAgJGNoYXJhY3Rl
cnNbJ8W8J10gPSAneic7CiAgICAkY2hhcmFjdGVyc1snxbonXSA9ICd6JzsKCiAg
ICAka2V5cyA9IGFycmF5X2tleXMoJGNoYXJhY3RlcnMpOwogICAgJHZhbHVlcyA9
IGFycmF5X3ZhbHVlcygkY2hhcmFjdGVycyk7CgogICAgcmV0dXJuIHN0cl9yZXBs
YWNlKCRrZXlzLCAkdmFsdWVzLCAkc3RyaW5nKTsKfQoKLyoqCiAqIFR3b3J6ZW5p
ZSBuYXp3eSBwbGlrdQogKiBAcGFyYW0gdHlwZSAkbGlzdGluZwogKiBAcmV0dXJu
IHR5cGUKICovCmZ1bmN0aW9uIG5pY2VfZmlsZW5hbWUoJGxpc3RpbmcpIHsKICAg
ICR0aXRsZSA9IHJlcGxhY2VfZGlhY3JpdGljcygkbGlzdGluZy0+dGl0bGUpOwog
ICAgJHRpdGxlID0gc3RyX3JlcGxhY2UoJyAnLCAnXycsICR0aXRsZSk7CiAgICAk
dGl0bGUgPSBzdHJfcmVwbGFjZShBcnJheSgnLycsICdcXCcpLCAnXycsICR0aXRs
ZSk7CiAgICAkZXh0ID0gc3RydG9sb3dlcihAZW5kKGV4cGxvZGUoIi4iLCAkbGlz
dGluZy0+bGluaykpKTsKICAgIGlmIChzdHJsZW4oJGV4dCkgPiA0KSAkZXh0ID0g
ImpwZyI7CiAgICBpZiAoc3RybGVuKCR0aXRsZSkgPiAzMCkgJHRpdGxlID0gc3Vi
c3RyKCR0aXRsZSwgMCwgMjUpOwogICAgcmV0dXJuICRsaXN0aW5nLT5pZCAuICdf
JyAuICR0aXRsZSAuICIueyRleHR9IjsKfQoKLyoqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCiAqIFN0cmltcyBBUEkKICoqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqLwoKaWYgKCFjbGFzc19leGlzdHMoJ1N0cmltcycpKSB7CiAg
ICByZXF1aXJlX29uY2UgIlN0cmltcy5jbGFzcy5waHAiOwp9CgokYXBpX29wdGlv
bnMgPSBBcnJheSgKICAgICdjb29raWVfZmlsZScgPT4gdGVtcG5hbShzeXNfZ2V0
X3RlbXBfZGlyKCksICdzdHJpbXMtZG93bmxvYWQtY29va2llJykKKTsKCiRzdHJp
bXMgPSBuZXcgU3RyaW1zKCRhcGlfb3B0aW9ucyk7CgovKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioKICogT3BjamUgLyBhcmd1bWVudHkKICoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqLwoKJHNjcmlwdF9vcHRpb25zID0gIEFy
cmF5KAogICAgJ3VzZXJuYW1lJyA9PiAnbmF6d2EgdcW8eXRrb3duaWthICh3eW1h
Z2FuZSknLAogICAgJ3Bhc3N3b3JkJyA9PiAnaGFzxYJvIHXFvHl0a293bmlrYSAo
d3ltYWdhbmUpJywKICAgICdzdHJpbScgPT4gJ25hendhIHN0cmltdSBucC4gInMv
Q2lla2F3b3N0a2kiJywKICAgICdmcm9tJyA9PiAnc3Ryb25hIHBvY3rEhXRrb3dh
JywKICAgICd0bycgPT4gJ3N0cm9uYSBrb8WEY293YScsCiAgICAncXVpZXQnID0+
ICduaWUgcG9rYXp1aiBwb3N0xJlwdScsCiAgICAnb3V0cHV0LWZpbGUnID0+ICdw
bGlrIHogd3luaWtpZW0gKHd5bWFnYW5lKScKKTsgICAgCgokaGVscCA9ICJVxbx5
Y2llOiBwaHAgc3RyaW1zLWRvd25sb2FkLWltYWdlcy5waHAgW09QQ0pFXSIuUEhQ
X0VPTDsKJGxvbmdfb3B0cyA9IEFycmF5KCk7Cgpmb3JlYWNoKCRzY3JpcHRfb3B0
aW9ucyBhcyAka2V5ID0+ICRkZXNjcmlwdGlvbikgewogICAgJGxvbmdfb3B0c1td
ID0gInska2V5fToiOwogICAgJGhlbHAgLj0gIiAtLXska2V5fSB7JGRlc2NyaXB0
aW9ufSIgLiBQSFBfRU9MOwp9Cgokb3B0ID0gZ2V0b3B0KCIiLCAkbG9uZ19vcHRz
KTsKJGhlbHAgLj0gIiAgICAKUHJ6eWvFgmFkIHXFvHljaWE6CnBocCBzdHJpbXMt
ZG93bmxvYWQtaW1hZ2VzLnBocCAtLXVzZXJuYW1lIEphbiAtLXBhc3N3b3JkIGR1
cGExMjMgLS1zdHJpbSBcInMvQ2lla2F3b3N0a2lcIiAtLW91dHB1dC1maWxlIGxp
bmtpLnR4dAoiOwoKaWYgKGVtcHR5KCRvcHQpKSB7CiAgICBlY2hvICRoZWxwOwog
ICAgZXhpdCgxKTsKfQoKJG9wdGlvbnMgPSBBcnJheSgKICAgICd1c2VybmFtZScg
ICAgICA9PiBpc3NldCgkb3B0Wyd1c2VybmFtZSddKSA/ICRvcHRbJ3VzZXJuYW1l
J10gOiBkaWUoIkLFgsSFZDogV3ltYWdhbmEgbmF6d2EgdcW8eXRrb3duaWthIiAu
IFBIUF9FT0wgLiBQSFBfRU9MIC4gJGhlbHApLAogICAgJ3Bhc3N3b3JkJyAgICAg
ID0+IGlzc2V0KCRvcHRbJ3Bhc3N3b3JkJ10pID8gJG9wdFsncGFzc3dvcmQnXSA6
IGRpZSgiQsWCxIVkOiBXeW1hZ2FuZSBoYXPFgm8gdcW8eXRrb3duaWthIiAuIFBI
UF9FT0wgLiBQSFBfRU9MIC4gJGhlbHApLAogICAgJ3BhZ2VfZnJvbScgICAgID0+
IGlzc2V0KCRvcHRbJ2Zyb20nXSkgPyAkb3B0Wydmcm9tJ10gOiAxLAogICAgJ3Bh
Z2VfdG8nICAgICAgID0+IGlzc2V0KCRvcHRbJ3RvJ10pID8gJG9wdFsndG8nXSA6
IDEsCiAgICAncXVpZXQnICAgICAgICAgPT4gaXNzZXQoJG9wdFsncXVpZXQnXSkg
PyAkb3B0WydxdWlldCddIDogMCwKICAgICdzdHJpbScgICAgICAgICA9PiBpc3Nl
dCgkb3B0WydzdHJpbSddKSA/ICRvcHRbJ3N0cmltJ10gOiBkaWUoIkLFgsSFZDog
V3ltYWdhbmEgbmF6d2Egc3RyaW11IiAuIFBIUF9FT0wgLiBQSFBfRU9MIC4gJGhl
bHApLAogICAgJ291dHB1dC1maWxlJyAgID0+IGlzc2V0KCRvcHRbJ291dHB1dC1m
aWxlJ10pID8gJG9wdFsnb3V0cHV0LWZpbGUnXSA6IGRpZSgiQsWCxIVkOiBXeW1h
Z2FueSBwbGlrIHd5asWbY2lvd3kiIC4gUEhQX0VPTCAuIFBIUF9FT0wgLiAkaGVs
cCksCik7CgppZiAoISgkb3B0aW9uc1sncGFnZV9mcm9tJ10gPiAwKSkgewogICAg
JG9wdGlvbnNbJ3BhZ2VfZnJvbSddID0gMTsKfQoKaWYgKCEoJG9wdGlvbnNbJ3Bh
Z2VfdG8nXSA+IDApKSB7CiAgICAkb3B0aW9uc1sncGFnZV90byddID0gMTsKfQoK
aWYgKCRvcHRpb25zWydwYWdlX3RvJ10gPCAkb3B0aW9uc1sncGFnZV9mcm9tJ10p
IHsKICAgICRvcHRpb25zWydwYWdlX3RvJ10gPSAkb3B0aW9uc1sncGFnZV9mcm9t
J107Cn0KCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBXxYJh
xZtjaXd5IHNrcnlwdAogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiov
CgppZiAoISRvcHRpb25zWydxdWlldCddKSB7IAogICAgZWNobyAiTG9nb3dhbmll
Li4uICI7Cn0KCmlmICghJHN0cmltcy0+bG9naW4oJG9wdGlvbnNbJ3VzZXJuYW1l
J10sICRvcHRpb25zWydwYXNzd29yZCddKSkgewogICAgZGllKCdCxYLEhWQ6IE5p
ZSBtb3puYSB6YWxvZ293YcSHJyk7Cn0KCmlmICghJG9wdGlvbnNbJ3F1aWV0J10p
IHsgCiAgICBlY2hvICJPSyIgLiBQSFBfRU9MOwp9CgokZmggPSBAZm9wZW4oJG9w
dGlvbnNbJ291dHB1dC1maWxlJ10sICd3Jyk7CmlmICghJGZoKSB7CiAgICBkaWUo
IkLFgmFkOiBOaWUgbW9nxJkgb3R3b3J6ecSHIHBsaWt1IHskb3B0aW9uc1snb3V0
cHV0LWZpbGUnXX0iIC4gUEhQX0VPTCAuIFBIUF9FT0wgLiAkaGVscCk7Cn0KCmZv
ciAoJHBhZ2UgPSAkb3B0aW9uc1sncGFnZV9mcm9tJ107ICRwYWdlIDw9ICRvcHRp
b25zWydwYWdlX3RvJ107ICRwYWdlKyspIHsKICAgIGlmICghJG9wdGlvbnNbJ3F1
aWV0J10pIHsKICAgICAgICBlY2hvICJQYXJzdWplIHN0cm9uZSB7JHBhZ2V9IHog
eyRvcHRpb25zWydwYWdlX3RvJ119Li4uICI7CiAgICB9CiAgICAkbGlzdGluZ3Mg
PSAkc3RyaW1zLT5nZXRfbGlzdGluZ3MoJG9wdGlvbnNbJ3N0cmltJ10sICRwYWdl
KTsKICAgIGlmIChlbXB0eSgkbGlzdGluZ3MpKSB7CiAgICAgICAgaWYgKCEkb3B0
aW9uc1sncXVpZXQnXSkgewogICAgICAgICAgICBlY2hvICJOaWUgbWEgd2nEmWNl
aiBsaW5rw7N3LiIgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICBleGl0Owog
ICAgfQogICAgZm9yZWFjaCAoJGxpc3RpbmdzIGFzICRsaXN0aW5nKSB7CiAgICAg
ICAgJGZpbGVuYW1lID0gbmljZV9maWxlbmFtZSgkbGlzdGluZyk7CiAgICAgICAg
ZndyaXRlKCRmaCwgInskbGlzdGluZy0+bGlua30geyRmaWxlbmFtZX0iIC4gUEhQ
X0VPTCk7CiAgICB9CiAgICBpZiAoISRvcHRpb25zWydxdWlldCddKSB7CiAgICAg
ICAgZWNobyAiT0siIC4gUEhQX0VPTDsKICAgIH0KfQoKZmNsb3NlKCRmaCk7
EOF
######################################################
# Sprawdzanie czy jest php, wget, openssl, file
######################################################

type php >/dev/null 2>&1 || { echo >&2 "PHP jest wymagane do uruchomienia skryptu"; exit 1; }
type openssl >/dev/null 2>&1 || { echo >&2 "openssl/base64 jest wymagane do odczytania i uruchomienia skryptu php"; exit 1; }
type wget >/dev/null 2>&1 || { echo >&2 "wget jest wymagane do pobrania obrazków"; exit 1; }
type file >/dev/null 2>&1 || { echo >&2 "file jest wymagane do pobrania obrazków"; exit 1; }

if php -r 'echo function_exists("curl_init") ? 1 : 0;' | grep -q "0"; then
    echo >&2 "Moduł Curl musi być zainstalowany i włączony dla PHP"; 
    exit 1;
fi

######################################################
# Argumenty
######################################################

usage() { 
    echo "Użycie: $0 [OPCJE]" 1>&2; 
    echo " -u nazwa użytkownika (wymagane)"
    echo " -p hasło użytkownika (wymagane)"
    echo " -s nazwa strimu (wymagane)"
    echo " -f strona od"
    echo " -t strona do"
    echo " -o katalog gdzie mają być zapisane zdjęcia"
    echo "Użytkownik musi miec wyłączone ramki w ustawieniach"
    echo ""
    echo "Przykład:"
    echo "$0 -u Jan -p dupa123 -s \"s/Ciekawostki\""
    exit 1; 
}

OPT_OUTPUT_DIR="./"
OPT_PAGE_FROM=1
OPT_PAGE_TO=1

while getopts ":u:p:f:t:s:o:" o; do
    case "${o}" in
        u)
            OPT_USERNAME=${OPTARG}            
            ;;
        p)
            OPT_PASSWORD=${OPTARG}
            ;;
        f)
            OPT_PAGE_FROM=${OPTARG}
            ;;
        t)
            OPT_PAGE_TO=${OPTARG}
            ;;
        s)
            OPT_STRIM=${OPTARG}
            ;;
        o)
            OPT_OUTPUT_DIR=${OPTARG}
            ;;
        *)
            ;;
    esac
done
shift $((OPTIND-1))

if [ -z "$OPT_USERNAME" ]; then
    echo "Podaj nazwę użytkownika"
    usage
fi

if [ -z "$OPT_PASSWORD" ]; then
    echo "Podaj hasło użytkownika"
    usage
fi

if [ -z "$OPT_STRIM" ]; then
    echo "Podaj nazwę strimu"
    usage
fi

######################################################
# Przygotowujemy plik PHP
######################################################

PHP_SCRIPT_FILE="/tmp/strims-download.$RANDOM.php"
echo "${PHP_SCRIPT}" | openssl base64 -d > ${PHP_SCRIPT_FILE}
chmod +x ${PHP_SCRIPT_FILE}

######################################################
# Odpalenie skryptu php co sprarsuje nam strima
######################################################

IMAGE_LIST_FILE="/tmp/strims-download.$RANDOM-list.txt"
php ${PHP_SCRIPT_FILE} --username $OPT_USERNAME --password $OPT_PASSWORD --strim $OPT_STRIM --from $OPT_PAGE_FROM --to $OPT_PAGE_TO --output-file $IMAGE_LIST_FILE
rm ${PHP_SCRIPT_FILE}

######################################################
# Pobieranie plików
######################################################

IMAGES_COUNT=$(cat $IMAGE_LIST_FILE | wc -l)
IMAGE_NR=1

while read -r IMG_URL IMG_FILENAME tail; do
    echo -n "Pobieranie obrazka $IMAGE_NR z $IMAGES_COUNT... "
    IMAGE_NR=`expr $IMAGE_NR + 1`
    IMG_FILEPATH="${OPT_OUTPUT_DIR}${IMG_FILENAME}"

    if [ -f "$IMG_FILEPATH" ]; then
        echo "Obrazek już pobrany"
        continue ;
    fi

    
    wget -q -nv -O "${IMG_FILEPATH}" "${IMG_URL}"
    # sprawdzamy co to za plik
    case $(file -b --mime-type  "$IMG_FILEPATH") in        
        image/jpeg)
            echo "OK (obrazek jpg)"
            ;;
        image/png)
            echo "OK (obrazek png)"
            ;;
        image/gif)
            echo "OK (obrazek gif)"
            ;;
        *)
            echo "To nie obrazek"
            rm $IMG_FILEPATH
            ;;
    esac
    
done <$IMAGE_LIST_FILE

echo "Gotowe!"